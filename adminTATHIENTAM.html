<!DOCTYPE html>
<html lang="vn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Lớp 7A7</title>
    <style>
      body {
          font-family: Arial, sans-serif;
          background-color: #a9d593;
          color: #333;
          text-align: center;
          padding: 50px;
      }

      .button {
          background-color: #498e4c;
          color: white;
          padding: 15px 32px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          font-size: 16px;
          margin: 10px;
          cursor: pointer;
          border: 2px solid #000000;
          border-radius: 15px;
          font-family: 'Times New Roman', Times, serif;
      }

      .button:hover {
          background-color: #3b7d3c;
      }

      .answers-list {
          background-color: white;
          padding: 20px;
          border-radius: 15px;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          max-width: 800px;
          margin: 20px auto;
          text-align: left;
      }

      .answer-item {
          border-bottom: 1px solid #ddd;
          padding: 10px 0;
      }

      .answer-item:last-child {
          border-bottom: none;
      }

      .blank-space {
          border: 1px dashed #ccc;
          height: 20px; /* Creates a visible blank space */
          margin: 10px 0;
      }

      .no-answers {
          color: #666;
          font-style: italic;
      }
    </style>
</head>
<body>
    <h1>Admin Panel - Lớp 7A7</h1>
    <p>Đây là nơi xem và tải xuống câu trả lời từ người dùng.</p>
    
    <button class="button" onclick="loadAnswers()">Tải lại câu trả lời</button>
    <button class="button" onclick="downloadAnswers()">Tải xuống JSON</button>
    <button class="button" onclick="acceptAndReset()">Accept</button>  <!-- New Accept button -->
    
    <div class="answers-list" id="answersList">
        <p class="no-answers">Chưa có câu trả lời nào. Nhấn "Tải lại câu trả lời" để kiểm tra.</p>
    </div>

    <script>
      function loadAnswers() {
        const answersList = document.getElementById('answersList');
        answersList.innerHTML = ''; // Clear previous content
        
        let hasAnswers = false;
        
        // Loop through all localStorage keys
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          
          // Check for pending answers (keys starting with '7A7_pending_')
          if (key.startsWith('7A7_pending_')) {
            hasAnswers = true;
            const data = JSON.parse(localStorage.getItem(key));
            
            const answerItem = document.createElement('div');
            answerItem.className = 'answer-item';
            
            // If data is empty (deleted), show blank space
            if (Object.keys(data).length === 0) {
              answerItem.innerHTML = '<div class="blank-space"></div>';
            } else {
              answerItem.innerHTML = `
                <strong>Tên:</strong> ${data.name || 'N/A'}<br>
                <strong>Ngày sinh:</strong> ${data.birthday || 'N/A'}<br>
                <strong>Số học sinh lớp:</strong> ${data.studentCount || 'N/A'}<br>
                <strong>Số bàn:</strong> ${data.deskNumber || 'N/A'}<br>
                <strong>Thời gian:</strong> ${new Date(parseInt(key.replace('7A7_pending_', ''))).toLocaleString('vi-VN')}<br>
                <button class="button" onclick="deleteAnswer('${key}')">Xóa</button>
              `;
            }
            answersList.appendChild(answerItem);
          }
        }
        
        if (!hasAnswers) {
          answersList.innerHTML = '<p class="no-answers">Không có câu trả lời nào.</p>';
        }
      }

      function downloadAnswers() {
        const data = {};
        
        // Collect all pending answers (skip blank ones)
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith('7A7_pending_')) {
            const itemData = JSON.parse(localStorage.getItem(key));
            if (Object.keys(itemData).length > 0) {  // Only include non-blank
              data[key] = itemData;
            }
          }
        }
        
        if (Object.keys(data).length === 0) {
          alert('Không có câu trả lời nào để tải xuống.');
          return;
        }
        
        // Create and download JSON file
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = '7A7_answers_' + new Date().toISOString().split('T')[0] + '.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      function deleteAnswer(key) {
        if (confirm('Bạn có chắc muốn xóa câu trả lời này?')) {
          // Replace with empty object to create blank space
          localStorage.setItem(key, JSON.stringify({}));
          loadAnswers(); // Reload the list
        }
      }

      function acceptAndReset() {
        if (confirm('Bạn có chắc muốn chấp nhận và reset? Điều này sẽ xóa tất cả câu trả lời và đặt trạng thái "still working on" trên trang chính.')) {
          // Clear all pending answers
          for (let i = localStorage.length - 1; i >= 0; i--) {
            const key = localStorage.key(i);
            if (key.startsWith('7A7_pending_')) {
              localStorage.removeItem(key);
            }
          }
          
          // Clear submitted status
          localStorage.removeItem('7A7_submitted');
          
          // Set status to 'working' to show "still working on" on main page
          localStorage.setItem('7A7_status', 'working');
          
          // Reload the answers list
          loadAnswers();
          
          alert('Đã chấp nhận và reset. Trang chính giờ sẽ hiển thị "still working on".');
        }
      }

      // Load answers on page load
      window.addEventListener('load', loadAnswers);
    </script>
</body>
</html>
