<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªõp 7A7</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Manrope', sans-serif; overflow-x: hidden; background: #050f0a; color: white; }
        .hero-section { position: relative; width: 100%; min-height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; background: linear-gradient(135deg, #050f0a 0%, #0a1e14 50%, #050f0a 100%); }
        .orb-container { position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: 1; pointer-events: none; }
        .orb { position: absolute; border-radius: 50%; filter: blur(60px); opacity: 0.8; animation: float 20s infinite ease-in-out; }
        .orb-1 { width: 800px; height: 550px; background: linear-gradient(225deg, rgba(7, 250, 163, 0.9) 0%, rgba(6, 244, 140, 0.79) 34%, rgba(6, 228, 115, 0.75) 40%, rgba(8, 157, 66, 0.41) 67%, rgba(4, 106, 45, 0) 100%); top: 15%; right: 10%; }
        .orb-2 { width: 800px; height: 550px; background: linear-gradient(45deg, rgba(6, 55, 23, 0) 0%, rgba(4, 106, 15, 0.43) 40%, rgba(1, 183, 62, 0.75) 70%, rgba(0, 208, 88, 0.83) 80%, rgb(2, 220, 100) 100%); filter: blur(40px); top: -5%; left: -5%; animation-delay: -7s; }
        @keyframes float { 0%, 100% { transform: translate(0, 0) scale(1); } 25% { transform: translate(20px, -20px) scale(1.05); } 50% { transform: translate(-20px, 20px) scale(0.95); } 75% { transform: translate(15px, 15px) scale(1.02); } }
        .content { position: relative; z-index: 10; text-align: center; padding: 60px 40px; max-width: 1200px; animation: fadeInUp 1s ease-out; }
        .main-title { font-size: clamp(48px, 8vw, 90px); font-weight: 800; color: #ffffff; letter-spacing: -0.05em; line-height: 1; margin-bottom: 40px; }
        .subtitle { font-size: clamp(14px, 2vw, 19px); font-weight: 300; color: rgba(255, 255, 255, 0.6); letter-spacing: 0.15em; line-height: 1.4; margin-bottom: 50px; text-transform: uppercase; }
        .cta-button, .submit-answer-btn { display: inline-block; padding: 20px 55px; font-size: 20px; font-weight: 800; color: #ffffff; background: rgba(255, 255, 255, 0.1); border: none; border-radius: 12px; cursor: pointer; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); backdrop-filter: blur(10px); text-decoration: none; font-family: 'Manrope', sans-serif; position: relative; z-index: 101; }
        .submit-answer-btn { background: linear-gradient(135deg, #07FAA3 0%, #02DC64 100%); color: #050f0a; }
        .submit-answer-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .quiz-container { display: none; position: relative; z-index: 10; text-align: center; padding: 60px 40px; max-width: 1000px; animation: slideIn 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .quiz-card { background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(20px); border-radius: 24px; padding: 50px 40px; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4); }
        .progress-bar { width: 100%; height: 6px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden; margin-bottom: 30px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #07FAA3 0%, #02DC64 100%); width: 0%; transition: width 0.5s ease; }
        .question-number { display: inline-block; background: #07FAA3; color: #050f0a; padding: 8px 20px; border-radius: 20px; font-size: 14px; font-weight: 700; margin-bottom: 30px; }
        .question-text { font-size: clamp(24px, 4vw, 36px); font-weight: 700; margin-bottom: 50px; }
        .input-container { margin: 40px 0; }
        .name-input { width: 100%; padding: 20px 30px; font-size: 20px; color: #ffffff; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 16px; outline: none; }
        .error-message { color: #ff4444; margin-top: 10px; display: none; }
        .error-message.show { display: block; }
        .hint-text { color: rgba(255, 255, 255, 0.4); font-size: 14px; margin-top: 10px; font-style: italic; display: none; }
        .hint-text.show { display: block; }
        .board-container { margin: 20px auto; max-width: 800px; }
        .board-header { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px; color: #07FAA3; font-weight: 800; font-size: 18px; }
        .board { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .seat { background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; cursor: pointer !important; transition: all 0.3s ease; font-weight: 700; min-height: 60px; display: flex; align-items: center; justify-content: center; position: relative; z-index: 60; }
        .seat:hover { background: rgba(7, 250, 163, 0.1); border-color: #07FAA3; }
        .seat.selected { background: rgba(7, 250, 163, 0.2); border-color: #07FAA3; }
        .admin-btn { position: fixed; top: 20px; right: 20px; padding: 10px 25px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; cursor: pointer; z-index: 1000; }
        .admin-panel { display: none; position: fixed; inset: 0; background: rgba(5,15,10,0.98); z-index: 2000; padding: 40px; overflow-y: auto; }
        .submission-card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .hidden { display: none !important; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>
    <div class="hero-section">
        <div class="orb-container"><div class="orb orb-1"></div><div class="orb orb-2"></div></div>
        <div class="content" id="welcomeContent">
            <h1 class="main-title">Ch√†o m·ª´ng ƒë·∫øn v·ªõi<br>L·ªõp 7A7</h1>
            <p class="subtitle">ƒêƒÉng nh√¢Ã£p ƒë√™Ãâ ti√™ÃÅp tuÃ£c</p>
            <button class="cta-button" id="startButton">Ti√™ÃÅp tuÃ£c</button>
        </div>
  <!-- PROFILE -->
  <div class="profile hidden" id="profileCard">
    <img id="avatar" class="avatar" src="https://via.placeholder.com/120"
         onclick="avatarInput.click()">
    <input type="file" id="avatarInput" hidden>

    <h1 id="fullName">H·ªç v√† t√™n</h1>
    <p id="accountName">@account</p>
    <p>üéÇ <span id="birth">---</span></p>

    <button class="profile-btn" onclick="location.href='place.html'">
      Go to the place ‚Üí
    </button>
  </div>

</div>

<!-- CONFIRM MODAL -->
<div id="confirmModal" class="hidden">
  <div class="confirm-box">
    <h2 id="confirmText"></h2>

    <div class="confirm-actions" id="confirmButtons">
      <button class="confirm-yes" onclick="confirmYes()">C√≥</button>
      <button class="confirm-no" onclick="confirmNo()">Kh√¥ng</button>
    </div>

    <div id="chatBox" class="hidden">
      <p>C√≥ chuy·ªán g√¨ kh√¥ng ƒë√∫ng?</p>
      <textarea id="chatInput"></textarea>
      <button class="chat-send" onclick="sendChat()">G·ª≠i & ti·∫øp t·ª•c</button>
    </div>
  </div>
</div>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey:"AIzaSyBx6YfJDocmt-WJQvsaKnaUEA_JohxdfC0",
  authDomain:"a7-thcsbk.firebaseapp.com",
  projectId:"a7-thcsbk"
});
const db=firebase.firestore();

/* ================= ELEMENTS ================= */
const loginButton=document.getElementById("loginButton");
const confirmModal=document.getElementById("confirmModal");
const confirmText=document.getElementById("confirmText");
const welcomeContent=document.getElementById("welcomeContent");
const profileCard=document.getElementById("profileCard");

const fullNameEl=document.getElementById("fullName");
const accountEl=document.getElementById("accountName");
const birthEl=document.getElementById("birth");

const avatar=document.getElementById("avatar");
const avatarInput=document.getElementById("avatarInput");

/* ================= HELPERS ================= */
function normalizeToId(str){
  return str.normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .replace(/ƒë/g,"d").toLowerCase().trim().replace(/\s+/g,"-");
}

/* ================= LOGIN ================= */
loginButton.onclick=async()=>{
  const studentName=localStorage.getItem("studentName");
  if(!studentName){alert("Ch∆∞a ƒëƒÉng nh·∫≠p");return;}

  const id=normalizeToId(studentName);
  const doc=await db.collection("students").doc(id).get();

  confirmText.innerText=`B·∫°n c√≥ ph·∫£i l√† ${studentName} kh√¥ng?`;
  confirmModal.classList.remove("hidden");

  window.__student={id,studentName,data:doc.exists?doc.data():{}};
};

/* ================= CONFIRM ================= */
function confirmYes(){
  const {studentName,data,id}=window.__student;

  fullNameEl.innerText=data.fullName||studentName;
  accountEl.innerText="@"+(data.account||id);
  birthEl.innerText=data.birth||"---";

  confirmModal.classList.add("hidden");
  welcomeContent.classList.add("hidden");
  profileCard.classList.remove("hidden");
}

function confirmNo(){
  document.getElementById("confirmButtons").classList.add("hidden");
  document.getElementById("chatBox").classList.remove("hidden");
}

function sendChat(){
  const msg=document.getElementById("chatInput").value.trim();
  if(!msg)return;

  db.collection("loginIssues").add({
    message:msg,
    time:new Date()
  });

  confirmYes();
}

/* ================= AVATAR ================= */
avatarInput.onchange=()=>{
  const f=avatarInput.files[0];
  if(!f)return;
  const r=new FileReader();
  r.onload=()=>{avatar.src=r.result;localStorage.setItem("avatar",r.result)};
  r.readAsDataURL(f);
};

const saved=localStorage.getItem("avatar");
if(saved)avatar.src=saved;
</script>
</body>
</html>
